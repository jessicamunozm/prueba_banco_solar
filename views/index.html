<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Banco Solar</title>

    <!-- BOOTSTRAP -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
   
   <!-- GOOGLE FONT QUICKSAND -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Quicksand&display=swap" rel="stylesheet">  
    
    <!-- FONT AWESOME -->
    <script src="https://kit.fontawesome.com/0bc1c63e85.js" crossorigin="anonymous"></script>

    <!-- FAVICON -->
    <link rel="icon" type="image/png" href="./assets/img/code-solid.svg">
    
    <!-- PALABRAS CLAVE -->
    <meta name="keywords" content="javascript, html, css, bootstrap, node, html5, pg, sql, express">

    <!-- CSS -->
<link rel="stylesheet" href="./assets/styles/style.css">

</head>

<body>
<!-- NAVBAR -->
<section id="navbar">
  <nav class="navbar navbar-expand-lg ">
    <div class="container">
        <img src="./assets/img/code-solid.svg" alt="icon" width="30" height="24">
        <a class="navbar-brand" href="#">Desafíos</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav container justify-content-end">

            <!-- MÓDULO 7 -->
<li class="nav-item">
  <div class="dropdown">
    <li class="nav-item dropdown">
      <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" >
        Módulo 7
      </a>
      <ul class="dropdown-menu">
        <li><a class="dropdown-item" href="#">Mi repertorio</a></li>
        <li><a class="dropdown-item" href="#">Always Music</a></li>
        <li><hr class="dropdown-divider"></li>
        <li><a class="dropdown-item" href="#">Banco Solar</a></li>
      </ul>
    </li>

<!-- MÓDULO 6 -->

<li class="nav-item">
  <div class="dropdown">
    <li class="nav-item dropdown">
      <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" >
        Módulo 6
      </a>
      <ul class="dropdown-menu">
        <li><a class="dropdown-item" href="#">Black and White</a></li>
        <li><a class="dropdown-item" href="#">Mercado Web</a></li>
        <li><a class="dropdown-item" href="#">Abracadabra</a></li>
        <li><hr class="dropdown-divider"></li>
        <li><a class="dropdown-item" href="#">Club deportivo</a></li>
      </ul>
    </li>

<!-- MÓDULO 5 -->
<li class="nav-item">
  <div class="dropdown">
    <li class="nav-item dropdown">
      <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" >
        Módulo 5
      </a>
      <ul class="dropdown-menu">
        <li><a class="dropdown-item" href="#">Modelos entidad-relación y relacional</a></li>
        <li><a class="dropdown-item" href="#">Definición de tablas</a></li>
        <li><a class="dropdown-item" href="#">Manipulación de datos y transaccionalidad en las operaciones</a></li>
        <li><a class="dropdown-item" href="#">Bases de datos relacionales</a></li>
        <li><hr class="dropdown-divider"></li>
        <li><a class="dropdown-item" href="#">Fundamentos de bases de datos relacionales</a></li>
      </ul>
    </li>

<!-- MÓDULO 4 -->
            <li class="nav-item">
              <div class="dropdown">
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" >
                    Módulo 4
                  </a>
                  <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="#">Traer post</a></li>
                    <li><a class="dropdown-item" href="#">Sugerencia de Videos</a></li>
                    <li><a class="dropdown-item" href="#">Clases ES6</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="#">Programación avanzada en Javascript</a></li>
                  </ul>
                </li>

            <!-- // MÓDULO 3 -->
            <li class="nav-item">
              <div class="dropdown">
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" >
                    Módulo 3
                  </a>
                  <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="#">Uso de métodos con arrays y objetos</a></li>
                    <li><a class="dropdown-item" href="#">Javascript en Práctica</a></li>
                    <li><a class="dropdown-item" href="https://jessicamunozm.github.io/desafio-cachipun/">Cachipún contra la máquina</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="https://jessicamunozm.github.io/prueba-modulo3/">Encuentra tu SuperHero</a></li>
                  </ul>
                </li>

<!-- MÓDULO 2 -->
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" >
                            Módulo 2
                          </a>
                          <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Branching con GitHub</a></li>
                            <li><a class="dropdown-item" href="#">Ricomida</a></li>
                            <li><a class="dropdown-item" href="#">Cuppon</a></li>
                            <li><a class="dropdown-item" href="#">Meet & Coffee</a></li>
                            <li><a class="dropdown-item" href="#">Iguana Page</a></li>
                            <li><a class="dropdown-item" href="#">Mi CV</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#">Viajes Chile</a></li>
                          </ul>
                      </li> 
                      </ul>
                    </div>
                  </div>
                    </nav>
</section>

  <section>
    <div class="text-center mt-5 mb-2">
    <img src="./assets/img/logo_banco.png" alt="logo_banco" width="80px">
  </div>
    <h2 class="text-center mb-4">Banco Solar C.A</h2>
    <div class="row m-auto px-5">
      <div class="col-12 col-sm-5">
        <form>
          <div class="form-group text-center">
            <h5>Agregar Nuevo Usuario</h5>
            <hr class="bg-white">
            <div class="d-flex align-items-center justify-content-center">
              Nombre:
              <input class="form-control d-inline mx-3" required />
              Balance:
              <input class="form-control d-inline mx-3" required />
              <button type="submit" class="btn">Agregar</button>
            </div>
          </div>
        </form>
        <br />
      </div>

      <div class="col-12 col-sm-7">
        <form>
          <div class="form-group text-center">
            <h5>Realizar una Transferencia</h5>
            <hr class="bg-white" />
            <div
              class="d-flex align-items-center justify-content-center flex-wrap"
            >
              <div class="mr-2">
                Emisor:
                <select
                  id="emisor"
                  class="form-control mx-2 w-auto d-inline"
                ></select>
              </div>

              <div class="mr-3">
                Receptor:
                <select
                  id="receptor"
                  class="form-control mx-2 w-auto d-inline"
                ></select>
              </div>

              <div class="mr-3">
                Monto:

                <input
                  type="text"
                  class="form-control mx-2 w-auto d-inline"
                  id="monto"
                />
              </div>

              <button type="submit" class="btn">Realizar</button>
            </div>
          </div>
        </form>
      </div>
      <div class="col-12 row mt-3 mx-0 px-0">
        <div class="col-12 col-sm-5 text-center">
          <h5>Tabla de usuarios</h5>
          <table class="table bg-light">
            <thead class="bg-danger text-white">
              <th>Nombre</th>
              <th>Balance</th>
              <th></th>
            </thead>
            <tbody class="usuarios"></tbody>
          </table>
        </div>

        <div class="col-12 col-sm-7 text-center">
          <h5>Tabla de Transferencias</h5>
          <table class="table bg-light">
            <thead class="bg-danger text-white">
              <th>Fecha</th>
              <th>Emisor</th>
              <th>Receptor</th>
              <th>Monto</th>
            </thead>
            <tbody class="transferencias">
              <tr>
                <td>25/01/2021 10:00</td>
                <td>Luis Vallejo</td>
                <td>Pedro Rivas</td>
                <td>60.000</td>
              </tr>
              <tr>
                <td>25/01/2021 13:15</td>
                <td>Pedro Rivas</td>
                <td>Luis Vallejo</td>
                <td>20.000</td>
              </tr>
              <tr>
                <td>25/01/2021 17:25</td>
                <td>Luis Vallejo</td>
                <td>Pedro Rivas</td>
                <td>30.000</td>
              </tr>

              <tr>
                <td>25/01/2021 21:04</td>
                <td>Pedro Rivas</td>
                <td>Luis Vallejo</td>
                <td>10.000</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <script
      src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
      integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
      integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"
      integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s"
      crossorigin="anonymous"
    ></script>
    <script src="https://momentjs.com/downloads/moment.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <div
      class="modal fade"
      id="exampleModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog text-dark" role="document">
        <div class="modal-content">
          <div class="modal-body">
            <div class="row">
              <div class="col-2">Nombre</div>
              <div class="col-10">
                <input id="nombreEdit" type="text" class="form-control" />
              </div>
            </div>
            <div class="row">
              <div class="col-2">Balance</div>
              <div class="col-10">
                <input id="balanceEdit" type="text" class="form-control" />
              </div>
            </div>

            <button class="btn btn-danger" id="editButton">Editar</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer>
    <div>
    <a href="https://www.linkedin.com/in/matjessicamu%C3%B1oz/"> <i class="fa-brands fa-linkedin"></i> </a>
    <a href="https://github.com/jessicamunozm"> <i class="fa-brands fa-github"></i></a>
    <a href="https://proyectos-adl.slack.com/team/U06CEFZET9U"><i class="fa-brands fa-slack"></i></a>
    <a href="https://wa.link/r3035x"><i class="fa-brands fa-whatsapp"></i></a>
  </div>
  
  <div id="footer">
  <h5>Jessica Muñoz </h5> 
  <h6>Bootcamp desarrollo de aplicaciones Full Stack JavaScript trainee</h6>
  <h6>Desafío Latam</h6>
  </div>
  </footer>
</body>
</html>

<style>
  body {
    background: #e5e1dd;
  }
  form {
    padding: 15px;
    background: #f8f9fa;
    border-radius: 10px;
  }
</style>

<script>
  const setInfoModal = (nombre, balance, id) => {
    $("#nombreEdit").val(nombre);
    $("#balanceEdit").val(balance);
    $("#editButton").attr("onclick", `editUsuario('${id}')`);
  };

  const editUsuario = async (id) => {
    const name = $("#nombreEdit").val();
    const balance = $("#balanceEdit").val();
    try {
      const { data } = await axios.put(
        `http://localhost:3000/usuario?id=${id}`,
        {
          name,
          balance,
        }
      );
      $("#exampleModal").modal("hide");
      location.reload();
    } catch (e) {
      alert("Algo salió mal..." + e);
    }
  };

  $("form:first").submit(async (e) => {
    e.preventDefault();
    let nombre = $("form:first input:first").val();
    let balance = Number($("form:first input:nth-child(2)").val());
    try {
      const response = await fetch("http://localhost:3000/usuario", {
        method: "post",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          nombre,
          balance,
        }),
      });
      $("form:first input:first").val("");
      $("form:first input:nth-child(2)").val("");
      location.reload();
    } catch (e) {
      alert("Algo salió mal ..." + e);
    }
  });

  $("form:last").submit(async (e) => {
    e.preventDefault();
    let emisor = $("form:last select:first").val();
    let receptor = $("form:last select:last").val();
    let monto = $("#monto").val();
    if (!monto || !emisor || !receptor) {
      alert("Debe seleccionar un emisor, receptor y monto a transferir");
      return false;
    }
    try {
      const response = await fetch("http://localhost:3000/transferencia", {
        method: "post",
        body: JSON.stringify({
          emisor,
          receptor,
          monto,
        }),
      });
      const data = await response.json();
      location.reload();
    } catch (e) {
      console.log(e);
      alert("Algo salió mal..." + e);
    }
  });

  const getUsuarios = async () => {
    const response = await fetch("http://localhost:3000/usuarios");
    let data = await response.json();
    $(".usuarios").html("");

    $.each(data, (i, c) => {
      $(".usuarios").append(`
              <tr>
                <td>${c.nombre}</td>
                <td>${c.balance}</td>
                <td>
                  <button
                    class="btn btn-warning mr-2"
                    data-toggle="modal"
                    data-target="#exampleModal"
                    onclick="setInfoModal('${c.nombre}', '${c.balance}', '${c.id}')"
                  >
                    Editar</button
                  ><button class="btn btn-danger" onclick="eliminarUsuario('${c.id}')">Eliminar</button>
                </td>
              </tr>
         `);

      $("#emisor").append(`<option value="${c.nombre}">${c.nombre}</option>`);
      $("#receptor").append(`<option value="${c.nombre}">${c.nombre}</option>`);
    });
  };

  const eliminarUsuario = async (id) => {
    const response = await fetch(`http://localhost:3000/usuario?id=${id}`, {
      method: "DELETE",
    });
    getUsuarios();
  };

  const getTransferencias = async () => {
    const { data } = await axios.get("http://localhost:3000/transferencias");
    $(".transferencias").html("");

    data.forEach((t) => {
      $(".transferencias").append(`
       <tr>
         <td> ${formatDate(t[4])} </td>
         <td> ${t[1]} </td>
         <td> ${t[2]} </td>
         <td> ${t[3]} </td>
       </tr>
     `);
    });
  };

  getUsuarios();
  getTransferencias();

  const formatDate = (date) => {
    const dateFormat = moment(date).format("L");
    const timeFormat = moment(date).format("LTS");
    return `${dateFormat} ${timeFormat}`;
  };
  formatDate();
</script>
